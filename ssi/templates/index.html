<!DOCTYPE html>
<html>
<head>
    <title>Title</title>

    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.9/angular.min.js"></script>

    <link
            href="https://cdn.pydata.org/bokeh/release/bokeh-1.0.4.min.css"
            rel="stylesheet" type="text/css">
    <link
            href="https://cdn.pydata.org/bokeh/release/bokeh-widgets-1.0.4.min.css"
            rel="stylesheet" type="text/css">
    <link
            href="https://cdn.pydata.org/bokeh/release/bokeh-tables-1.0.4.min.css"
            rel="stylesheet" type="text/css">

    <script src="https://cdn.pydata.org/bokeh/release/bokeh-1.0.4.min.js"></script>
    <script src="https://cdn.pydata.org/bokeh/release/bokeh-widgets-1.0.4.min.js"></script>
    <script src="https://cdn.pydata.org/bokeh/release/bokeh-tables-1.0.4.min.js"></script>

    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"/>

    <script src="{{ url_for('static', filename='app.js') }}"></script>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

{% raw %}

<div class="app" ng-app="app" ng-controller="controller">

    <div class="spinner" ng-if="isLoading">
        <i class="fa fa-pulse fa-spinner"></i>
    </div>

    <div>
        <label>Header type</label>
        <select ng-model="header"
                ng-init="header = 'source'">
            <option ng-repeat="(key, value) in labels" value="{{ key }}">{{ value }}</option>
        </select>
        <button ng-click="addFilter($event)">add filter</button>
    </div>

    <table>
        <tr ng-repeat="filter in filters">
            <td>
                <button ng-click="deleteFilter($event, $index)">delete filter</button>
            </td>
            <td>
                <label>{{ filter.label }}: </label>
            </td>
            <td>
                <select ng-model="filters[$index].name"
                        ng-if="!filter.numerical"
                        ng-init="filters[$index].name = columns[filter.header][0].value">
                    <option ng-repeat="col in columns[filter.header]"
                            value="{{ col.value }}">
                        {{ col.value }}
                    </option>
                </select>

                <span ng-if="filter.numerical">
                    <select ng-model="filters[$index].comparator"
                            ng-init="filters[$index].comparator = '<'">
                        <option value="<">&lt;</option>
                        <option value=">">&gt;</option>
                        <option value="=">=</option>
                    </select>

                    <input type="text"
                           ng-model="filters[$index].comparedValue"
                           placeholder="value"/>
                </span>
            </td>
            <td>
                <span ng-if="!filter.numerical">
                    <label>Filter out?</label>
                    <input type="checkbox" ng-model="filters[$index].filtered"/>
                </span>
            </td>
            <td>
                <select ng-model="filters[$index].bool"
                        ng-init="filters[$index].bool = 'and'"
                        ng-if="filters.length > 1 && $index != filters.length - 1">
                    <option value="and">and</option>
                    <option value="or">or</option>
                </select>
            </td>
        </tr>
    </table>

    <!--<label>Filter on hydrogen bond types?</label>
    <input type="checkbox" ng-model="filters.hbondType"/>-->

    <button ng-click="submitForm($event)">submit</button>

    <div ng-if="filename">
        <div>{{ filename }}</div>
        <button ng-click="downloadFilter($event)">download</button>
    </div>

</div>

{% endraw %}

<div class="container">

    <div class="upload-form">

        <form method=post enctype=multipart/form-data>
            <div class="form-row">
                <input type=file name=file>
            </div>

            <div class="form-row">
                <label>Minimum bucket size</label>
                <input type="number" name="min-bucket-size" min=0 value=20>
            </div>

            <div class="form-row">
                <input type=submit value=Submit>
            </div>
        </form>

    </div>

    {% if name != None %}
        <h1>Graph for {{ name }}</h1>
    {% endif %}

    <div class="graph-container">

        <div class="graph" id="scatter">
            {{ scatter_div | safe }}
            {{ scatter_script | safe }}
        </div>

        <div class="graph" id="means">
            {{ means_div | safe }}
            {{ means_script | safe }}
        </div>

    </div>

</div>

<script src="{{ url_for('static', filename='controller.js') }}"></script>

</body>
</html>
